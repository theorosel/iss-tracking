function App(t){this.$el={},this.$el.container=t,this.$el.altitude=this.$el.container.querySelector(".altitude"),this.$el.speed=this.$el.container.querySelector(".speed"),this.$el.city_over=this.$el.container.querySelector(".city"),this.$el.feed_link=this.$el.container.querySelector(".link-feed"),this.$el.team_link=this.$el.container.querySelector(".link-team"),this.$el.earth=this.$el.container.querySelector("#earth"),this.$el.markers=null,this.options={atmosphere:!1,center:[0,0],zoom:2.5,zooming:!1,unconstrainedRotation:!0,sky:!0},this.earth=new WE.map("earth",this.options),this.path=[],this.ship_path=[],this.markers=[],this.latest_tweets=[];var e=this;this.$el.feed_link.addEventListener("click",function(t){e.toggle_feed()}),this.$el.team_link.addEventListener("click",function(t){e.toggle_team()}),setInterval(function(){e.get_iss_data()},3e3),this.init=function(){this.get_latest_tweets(),setTimeout(function(){for(var t=0;t<e.latest_tweets.length;t++)e.get_twitter_pos(e.latest_tweets[t].picture),e.add_mark(t,t),$popup=document.createElement("div"),$popup.classList.add("marker-popup"),$image=document.createElement("img"),$image.classList.add("popup-image"),$image.setAttribute("src",e.latest_tweets[t].picture),$text=document.createElement("p"),$text.classList.add("popup-text"),$text.innerText=e.latest_tweets[t].tweet_text,$popup.appendChild($image),$popup.appendChild($text),console.log(e.latest_tweets[t].tweet_text),e.markers[t].element.appendChild($popup),e.markers[t].element.addEventListener("mouseover",function(){this.lastChild.style.opacity=1,this.lastChild.style.transform="scale(1)"}),e.markers[t].element.addEventListener("mouseleave",function(){this.lastChild.style.opacity=0,this.lastChild.style.transform="scale(0)"})},2e3),console.log(this.markers)},this.get_latest_tweets=function(){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var t=JSON.parse(this.responseText);console.log(t);for(var s=0;s<t.length;s++)e.latest_tweets.push(t[s])}},t.open("GET","/api/twitter",!0),t.send()},this.get_twitter_pos=function(){},this.initialize=function(){WE.tileLayer("http://tileserver.maptiler.com/nasa/{z}/{x}/{y}.jpg",{minZoom:0,maxZoom:300,zooming:!1,attribution:"NASA"}).addTo(this.earth)},this.get_iss_data=function(){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var t=JSON.parse(this.responseText).altitude,s=JSON.parse(this.responseText).latitude,i=JSON.parse(this.responseText).longitude,a=JSON.parse(this.responseText).velocity;e.draw_travel(s,i),e.get_city_overflown(s,i),e.update_speed(a),e.update_altitude(t),e.move_iss(s,i)}},t.open("GET","https://api.wheretheiss.at/v1/satellites/25544&units=miles",!0),t.send()},this.get_city_overflown=function(t,s){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var t=JSON.parse(this.responseText).timezone_id,s=t.split("/"),t=s[0]+" - "+s[1];e.$el.city_over.innerText="",e.$el.city_over.innerText=t}else if(4==this.readyState&&200!=this.status){var t="Ocean";e.$el.city_over.innerText="",e.$el.city_over.innerText=t}},i.open("GET","https://api.wheretheiss.at/v1/coordinates/"+t+","+s,!0),i.send()},this.draw_travel=function(t,e){var s=WE.marker([t,e]).addTo(this.earth);$path=s.element.firstChild,$path.classList.remove("we-pm-icon"),$path.removeAttribute("style"),$path.classList.add("we-pm-icon-path"),this.path.length<=150?this.path.push($path):(this.path[0].remove(),this.path.shift(),this.path.push($path))},this.move_iss=function(t,e){var s=WE.marker([t,e]).addTo(this.earth);$ship=s.element.firstChild,$ship.classList.remove("we-pm-icon"),$ship.removeAttribute("style"),$ship.classList.add("we-pm-icon-ship"),this.ship_path.length<=1?this.ship_path.push($ship):(this.ship_path[0].remove(),this.ship_path.shift(),this.ship_path.push($ship))},this.add_mark=function(t,s){var i=WE.marker([t,s]).addTo(this.earth);$marker=i.element.firstChild,$marker.classList.remove("we-pm-icon"),$marker.removeAttribute("style"),$marker.classList.add("we-pm-icon-marker"),e.markers.push(i)},this.update_speed=function(t){t=t.toString(),t=t.substring(0,8),this.$el.speed.innerText="",this.$el.speed.innerText=t+" km/h"},this.update_altitude=function(t){console.log(t),t=t.toString(),t=t.substring(0,6),this.$el.altitude.innerText="",this.$el.altitude.innerText=t+" kilometers"},this.toggle_feed=function(){this.$el.feed_link.classList.toggle("active"),this.$el.container.classList.toggle("feed-mode"),this.$el.team_link.classList.remove("active"),this.$el.container.classList.remove("team-mode")},this.toggle_team=function(){this.$el.team_link.classList.toggle("active"),this.$el.container.classList.toggle("team-mode"),this.$el.feed_link.classList.remove("active"),this.$el.container.classList.remove("feed-mode")}}var earth=new App(document.querySelector(".app"));document.addEventListener("DOMContentLoaded",function(t){earth.init(),earth.initialize(),t.preventDefault(t)});